#+TITLE: Chai (æ‹†) - ç ´åæ€§é˜…è¯»ä¸çŸ¥è¯†æ¶ˆåŒ–
#+AUTHOR: Yibie
#+EMAIL: yibie@outlook.com
#+DATE: 2025-01

* Chai (æ‹†)

"æ‹†"â€”â€”å°†å¤æ‚çš„çŸ¥è¯†æ‹†è§£ã€æ¶ˆåŒ–ã€é‡ç»„ä¸ºè‡ªå·±çš„ç†è§£ã€‚

Chai æ˜¯ä¸€ä¸ª Emacs çŸ¥è¯†ç®¡ç†å·¥ä½œæµï¼Œæä¾›ä¸¤å¤§æ ¸å¿ƒæ¨¡å—ï¼š

1. *Library (çŸ¥è¯†åº“)* â€”â€” ç®¡ç†é˜…è¯»ææ–™ï¼Œæ”¯æŒä» PDF/Markdown/EPUB/HTML å¯¼å…¥
2. *Refinery (æ‹†è§£å·¥åŠ)* â€”â€” å°†å†…å®¹"åˆ†å‰"åˆ°å·¥ä½œå°è¿›è¡Œæ·±åº¦åŠ å·¥

#+begin_quote
ğŸ“– é˜…è¯» â†’ ğŸ”§ æ‹†è§£ â†’ âœ¨ å†…åŒ–
#+end_quote

** æ¼”ç¤º

[[file:pics/demo.gif]]

* å®‰è£…

** ä¾èµ–

- Emacs 29.1+
- [[https://pandoc.org/][Pandoc]] (æ–‡ä»¶è½¬æ¢)
- Python 3.x + PyMuPDF (PDF å¤„ç†)

*** macOS OCR æ”¯æŒï¼ˆå¯é€‰ï¼‰

#+begin_src bash
pip install pyobjc-framework-Vision Pillow
#+end_src

âš ï¸ OCR åŠŸèƒ½ä»…åœ¨ macOS ä¸Šå¯ç”¨ï¼Œä½¿ç”¨ Apple Vision æ¡†æ¶è¯†åˆ«æ‰«æç‰ˆ PDFã€‚

** é…ç½®

#+begin_src elisp
;; æ·»åŠ åˆ° load-path
(add-to-list 'load-path "~/path/to/chai/")

;; åŠ è½½æ ¸å¿ƒæ¨¡å—
(require 'chai)               ;; Refinery æ‹†è§£å·¥åŠ
(require 'chai-library)       ;; Library çŸ¥è¯†åº“
(require 'chai-library-table) ;; Library è¡¨æ ¼ç•Œé¢

;; å¯é€‰ï¼šå…¨å±€å¿«æ·é”®
(global-set-key (kbd "C-c l") #'chai-library-open)
(global-set-key (kbd "C-c r") #'chai-switch-draft)
#+end_src

** ç›®å½•ç»“æ„

Chai é»˜è®¤ä½¿ç”¨ä»¥ä¸‹ç›®å½•ç»“æ„ï¼ˆå‡åœ¨ =~/.emacs.d/chai/= ä¸‹ï¼‰ï¼š

#+begin_example
~/.emacs.d/chai/
â”œâ”€â”€ library/          ;; çŸ¥è¯†åº“æ–‡ä»¶
â”œâ”€â”€ inbox/            ;; å¾…å¯¼å…¥æ–‡ä»¶
â”œâ”€â”€ archive/          ;; å¯¼å…¥ååŸæ–‡ä»¶å½’æ¡£
â””â”€â”€ refinery.org      ;; æ‹†è§£å·¥ä½œå°
#+end_example

å¯é€šè¿‡ä»¥ä¸‹å˜é‡è‡ªå®šä¹‰ï¼š

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------+------+--------|
| =chai-library-directory= | çŸ¥è¯†åº“ç›®å½• | =~/.emacs.d/chai/library/= |
| =chai-library-import-inbox= | å¯¼å…¥æ”¶ä»¶ç®± | =~/.emacs.d/chai/inbox/= |
| =chai-library-import-archive= | å½’æ¡£ç›®å½• | =~/.emacs.d/chai/archive/= |
| =chai-refinery-file= | å·¥ä½œå°æ–‡ä»¶ | =~/.emacs.d/chai/refinery.org= |

* Library (çŸ¥è¯†åº“)

** å¯¼å…¥æ–‡ä»¶

*** æ–¹å¼ 1ï¼šEmacs å‘½ä»¤ï¼ˆæ¨èï¼‰

- =M-x chai-library-import= â€”â€” æ‰¹é‡å¯¼å…¥ inbox ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶
- =C-u M-x chai-library-import= â€”â€” å¯¼å…¥å•ä¸ªæŒ‡å®šæ–‡ä»¶

*** æ–¹å¼ 2ï¼šå‘½ä»¤è¡Œ

#+begin_src bash
# æ‰¹é‡å¯¼å…¥
python convert-to-org.py \
  --temp ~/.emacs.d/chai/inbox/ \
  --reference ~/.emacs.d/chai/library/ \
  --archive ~/.emacs.d/chai/archive/

# å•æ–‡ä»¶å¯¼å…¥
python convert-to-org.py \
  --file ~/Downloads/paper.pdf \
  --reference ~/.emacs.d/chai/library/
#+end_src

*** æ”¯æŒæ ¼å¼

- PDFï¼ˆæ”¯æŒæ‰«æç‰ˆ OCRï¼Œä»…é™ macOSï¼‰
- Markdown
- EPUB
- HTML

** æ–‡ä»¶åæ ¼å¼

å¯¼å…¥åçš„æ–‡ä»¶ä½¿ç”¨ç»“æ„åŒ–å‘½åï¼š

#+begin_example
ID__Author__Title==keyword1_keyword2--status-rating.org
#+end_example

åˆ†éš”ç¬¦å«ä¹‰ï¼š
- =__= â€”â€” å…ƒæ•°æ®åˆ†éš”ï¼ˆIDã€ä½œè€…ã€æ ‡é¢˜ï¼‰
- ==== â€”â€” å…³é”®è¯åˆ†éš”
- =--= â€”â€” çŠ¶æ€å’Œè¯„åˆ†

** ä½¿ç”¨ Library

è¿è¡Œ =M-x chai-library-open= æ‰“å¼€çŸ¥è¯†åº“ç•Œé¢ï¼ˆå…¨å±æ˜¾ç¤ºï¼‰ï¼š

[[file:pics/chai-library.png]]

| æŒ‰é”® | åŠŸèƒ½ |
|------+------|
| =RET= | æ‰“å¼€é€‰ä¸­çš„ä¹¦ç±/æ–‡æ¡£ |
| =s= | è®¾ç½®é˜…è¯»çŠ¶æ€ï¼ˆunread/reading/done/archivedï¼‰ |
| =r= / =0-5= | è®¾ç½®è¯„åˆ†ï¼ˆ0-5 æ˜Ÿï¼‰ |
| =k= | è®¾ç½®å…³é”®è¯ï¼ˆé€—å·åˆ†éš”ï¼Œç¼–ç åˆ°æ–‡ä»¶åä¸­ï¼‰ |
| =a= | é‡å‘½åä¸º Chai æ ¼å¼ï¼ˆæ·»åŠ  IDï¼‰ |
| =d= | åˆ é™¤æ–‡ä»¶ï¼ˆéœ€ç¡®è®¤ï¼‰ |
| =/= | æŒ‰æ ‡é¢˜/ä½œè€…/å…³é”®è¯è¿‡æ»¤ |
| =c= | æ¸…é™¤è¿‡æ»¤ |
| =S= | åˆ‡æ¢æ’åºæ–¹å¼ |
| =g= | åˆ·æ–°åˆ—è¡¨ |

* Refinery (æ‹†è§£å·¥åŠ)

** å·¥ä½œæµ

#+begin_example
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æºæ–‡ä»¶     â”‚ â”€â”€â–¶ â”‚   åˆ†å‰      â”‚ â”€â”€â–¶ â”‚   åŠ å·¥      â”‚ â”€â”€â–¶ â”‚   ä¿å­˜      â”‚
â”‚  (Library)  â”‚      â”‚ (Refinery)  â”‚      â”‚  (å‹ç¼©/é‡å†™) â”‚      â”‚  (æ°¸ä¹…ç¬”è®°)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#+end_example

** å‘½ä»¤

| å‘½ä»¤ | åŠŸèƒ½ |
|------+------|
| =M-x chai-refine-heading= | åˆ†å‰å½“å‰æ ‡é¢˜åˆ° Refinery |
| =M-x chai-refine-region= | åˆ†å‰é€‰ä¸­çš„åŒºåŸŸ |
| =M-x chai-switch-draft= | åˆ‡æ¢/æ‰“å¼€å¾…å¤„ç†çš„è‰ç¨¿ |
| =C-c C-c= | ä¿å­˜ä¸ºæ°¸ä¹…ç¬”è®° |
| =C-c h= | çº¯é«˜äº®ï¼ˆæ— æ³¨é‡Šï¼‰ |
| =C-c H= | é«˜äº® + æ³¨é‡Š |
| =C-c d= | åˆ é™¤é«˜äº® |
| =C-c p= | åˆ‡æ¢ä¸Šä¸‹æ–‡é¢æ¿ |
| =C-c C-r= | åˆ·æ–°æ³¨é‡Šæ˜¾ç¤º |

** å‹ç¼©è¿›åº¦æ¡

åœ¨ Refinery ä¸­ç¼–è¾‘æ—¶ï¼Œheader-line ä¼šæ˜¾ç¤ºå®æ—¶å‹ç¼©è¿›åº¦ï¼š

#+begin_example
æ‹† 45% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  (1000 â†’ 550 å­—)
#+end_example

[[file:pics/chai-workbench.png]]

** é«˜äº®ç³»ç»Ÿ

åœ¨é˜…è¯»æ—¶æ ‡è®°é‡è¦å†…å®¹ï¼Œå…± 12 ç§è¯­ä¹‰åŒ–ç±»å‹ã€‚åªè¦ org æ–‡ä»¶ä¸­åŒ…å« chai é“¾æ¥ï¼Œ
æ³¨é‡Š overlay ä¼šåœ¨æ–‡ä»¶æ‰“å¼€æ—¶è‡ªåŠ¨æ¸²æŸ“ï¼Œæ— éœ€æ‰‹åŠ¨å¯ç”¨ =chai-mode=ã€‚

[[file:pics/chai-annotation.png]]

*** åŸæœ‰ç±»å‹

- ğŸ”´ *important* â€”â€” é‡è¦è§‚ç‚¹
- ğŸŸ¢ *idea* â€”â€” çµæ„Ÿ/æƒ³æ³•
- ğŸŸ  *question* â€”â€” ç–‘é—®
- ğŸŸ¡ *critical* â€”â€” å…³é”®å†…å®¹

*** æ‰©å±•ç±»å‹

- ğŸ’› *key* â€”â€” ä¸­å¿ƒæ€æƒ³/ä¸»æ—¨å¥ï¼ˆé»„è‰²é«˜äº®ï¼‰
- ğŸ”´ *core* â€”â€” å®šä¹‰/æ ¸å¿ƒè€ƒç‚¹ï¼ˆçº¢/æ©™è‰²é«˜äº®ï¼‰
- ğŸŸ¢ *detail* â€”â€” æ•°æ®/å…³é”®ç»†èŠ‚ï¼ˆç»¿è‰²ä¸‹åˆ’çº¿ï¼‰
- ğŸ”µ *example* â€”â€” æ¡ˆä¾‹/è¾…åŠ©è¯æ®ï¼ˆè“è‰²ä¸‹åˆ’çº¿ï¼‰
- ğŸŸ£ *hard* â€”â€” éš¾ç‚¹/é€»è¾‘è½¬æŠ˜ï¼ˆç´«è‰²æ³¢æµªçº¿ï¼‰
- â¬œ *block* â€”â€” å®Œæ•´è§‚ç‚¹æ®µè½ï¼ˆç°è‰²è¾¹æ¡†ï¼‰
- ğŸŸª *view* â€”â€” ä½œè€…è§‚ç‚¹/ä¸ªäººå¿ƒå¾—ï¼ˆç´«è‰²ï¼‰
- âš« *outdated* â€”â€” æ’é™¤/è¿‡æ—¶ä¿¡æ¯ï¼ˆåˆ é™¤çº¿ï¼‰

è‡ªå®šä¹‰é«˜äº®ç±»å‹ï¼š

#+begin_src elisp
(setq chai-highlight-types
      '(("important" . chai-highlight-important)
        ("idea" . chai-highlight-idea)
        ("key" . chai-highlight-key)
        ;; ... æ·»åŠ è‡ªå®šä¹‰ç±»å‹
        ("todo" . hl-line)))
#+end_src

** ä¸Šä¸‹æ–‡é¢æ¿

æŒ‰ =C-c p= åˆ‡æ¢ä¾§è¾¹çª—å£ï¼Œæ˜¾ç¤ºå½“å‰ buffer æ‰€æœ‰é«˜äº®æŒ‰ç±»å‹åˆ†ç»„ã€‚å…‰æ ‡æ‰€åœ¨é«˜äº®çš„ç±»å‹ç»„ä¼šé«˜äº®æ˜¾ç¤ºï¼Œæ–¹ä¾¿å®šä½ã€‚

** ä¿å­˜æ¨¡å¼

*** å¤šæ–‡ä»¶æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰

æ¯æ¡ç¬”è®°ä¿å­˜ä¸ºç‹¬ç«‹çš„ Org æ–‡ä»¶ï¼š

#+begin_src elisp
(setq chai-note-saving-style 'multi-file)
(setq chai-notes-directory "~/notes/chai/")
#+end_src

*** å•æ–‡ä»¶æ¨¡å¼

æ‰€æœ‰ç¬”è®°è¿½åŠ åˆ°ç»Ÿä¸€çš„æ–‡ä»¶ä¸­ï¼š

#+begin_src elisp
(setq chai-note-saving-style 'single-file)
(setq chai-unified-notes-file "~/notes/chai-notes.org")
#+end_src

* å¿«é€Ÿå…¥é—¨

1. *å‡†å¤‡ææ–™* â€”â€” å°† PDF/EPUB/Markdown æ–‡ä»¶æ”¾å…¥ inbox ç›®å½•
2. *å¯¼å…¥* â€”â€” è¿è¡Œ =M-x chai-library-import=
3. *æ‰“å¼€ Library* â€”â€” =M-x chai-library-open=ï¼ŒæŒ‰ =RET= æ‰“å¼€æ–‡æ¡£
4. *æ‹†è§£* â€”â€” åœ¨æ–‡æ¡£ä¸­å®šä½åˆ°æƒ³æ‘˜å½•çš„æ ‡é¢˜ï¼Œ=M-x chai-refine-heading=
5. *åŠ å·¥* â€”â€” åœ¨ Refinery ä¸­é‡å†™ã€å‹ç¼©å†…å®¹
6. *ä¿å­˜* â€”â€” =C-c C-c= ä¿å­˜ä¸ºæ°¸ä¹…ç¬”è®°

* é“¾æ¥ç³»ç»Ÿ

Chai ä½¿ç”¨ =chai:= é“¾æ¥åè®®å®ç°çŸ¥è¯†å…³è”ï¼š

- åœ¨ Refinery ä¸­ï¼Œ=SOURCE= å±æ€§è‡ªåŠ¨è®°å½•å†…å®¹æ¥æº
- é«˜äº®æ–‡æœ¬ä½¿ç”¨ =[[chai:type][text]]= æ ¼å¼
- ç‚¹å‡»é«˜äº®å¯è·³è½¬åˆ°åŸæ–‡ï¼ˆå¦‚æœæ¥æºæ˜¯ Library ä¸­çš„ä¹¦ç±ï¼‰

* ä¸å…¶ä»–å·¥å…·é›†æˆ

Chai è®¾è®¡ä¸ºä¸ç°æœ‰ç¬”è®°ç³»ç»ŸååŒå·¥ä½œï¼š

- *Org-roam* â€”â€” Refinery ä¿å­˜çš„ç¬”è®°å¯æ”¾å…¥ Org-roam ç›®å½•
- *Denote* â€”â€” Chai ä½¿ç”¨ä¸ Denote å…¼å®¹çš„æ—¶é—´æˆ³ ID
- *Citar/Org-cite* â€”â€” åœ¨ä¹¦ç±æ–‡ä»¶ä¸­æ·»åŠ  =#+BIBLIOGRAPHY= å¼•ç”¨

* è´¡çŒ®

æ¬¢è¿ Issue å’Œ PRï¼

- ä»£ç é£æ ¼ï¼šéµå¾ªæ ‡å‡† Emacs Lisp è§„èŒƒ
- æµ‹è¯•ï¼šå¦‚æœ‰æ–°å¢åŠŸèƒ½ï¼Œè¯·åœ¨ =test/= ç›®å½•æ·»åŠ æµ‹è¯•
- æ–‡æ¡£ï¼šæ›´æ–°æ­¤ README ä»¥åæ˜ åŠŸèƒ½å˜æ›´

* è®¸å¯è¯

GPL-3.0-or-later

* ä½œè€…

Yibie <yibie@outlook.com>

* è‡´è°¢

- è®¾è®¡ç†å¿µå— Zettelkasten å’Œæ¸è¿›å¼æ€»ç»“æ³•å¯å‘
- tp.el æä¾›å“åº”å¼ UI æ”¯æŒ

* Changelog

** v1.1.0 (2026-02)

- *Library*ï¼šæ–°å¢ =k= å¿«æ·é”®ï¼Œç”¨äºä¸ºä¹¦ç›®è®¾ç½®å…³é”®è¯ï¼›å…³é”®è¯ç¼–ç åˆ°æ–‡ä»¶å
  ï¼ˆ===kw1_kw2= æ®µï¼‰ï¼Œå¯é€šè¿‡ =/= è¿‡æ»¤æœç´¢
- *Library*ï¼šä¿®å¤å…³é”®è¯åˆ—åœ¨æ›´æ”¹åä¸åˆ·æ–°çš„æ˜¾ç¤ºé—®é¢˜
- *Library*ï¼šæ‰“å¼€æ—¶è‡ªåŠ¨å…¨å±ï¼ˆ=delete-other-windows=ï¼‰
- *æ³¨é‡Š*ï¼šåŒ…å« chai é“¾æ¥çš„ä»»æ„ org æ–‡ä»¶æ‰“å¼€æ—¶è‡ªåŠ¨æ¸²æŸ“æ³¨é‡Š overlayï¼Œ
  æ— éœ€æ‰‹åŠ¨å¯ç”¨ =chai-mode=

** v1.0.0 (2025-01)

- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- Library çŸ¥è¯†åº“ç®¡ç†
- Refinery æ‹†è§£å·¥åŠ
- é«˜äº®ä¸é“¾æ¥ç³»ç»Ÿï¼ˆ12 ç§è¯­ä¹‰åŒ–ç±»å‹ï¼‰
- ä¸Šä¸‹æ–‡é¢æ¿ï¼ˆæŒ‰ç±»å‹åˆ†ç»„æ˜¾ç¤ºé«˜äº®ï¼‰
- macOS OCR æ”¯æŒ
